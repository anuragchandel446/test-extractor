<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Text-to-Speech - Moon Stoners TTS Reader</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <!-- Custom Cosmic Theme -->
    <link rel="stylesheet" href="kc.css" />
    <style>
        .nav-breadcrumb {
            background: rgba(10, 10, 15, 0.1);
            border-radius: 10px;
            padding: 0.5rem 1rem;
            margin-bottom: 1rem;
            border: 1px solid rgba(0, 212, 255, 0.1);
        }
        
        .nav-breadcrumb a {
            color: var(--cosmic-cyan);
            text-decoration: none;
        }
        
        .nav-breadcrumb a:hover {
            color: var(--aurora-pink);
        }
        
        .main-editor {
            min-height: 400px;
        }
        
        .voice-preview-section {
            background: linear-gradient(135deg, 
                rgba(157, 78, 221, 0.1), 
                rgba(0, 212, 255, 0.1));
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }
        
        .playback-controls {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 20px;
            padding: 1rem;
            text-align: center;
        }
        
        .control-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: none;
            margin: 0 0.5rem;
            font-size: 1.5rem;
            transition: all 0.3s ease;
        }
        
        .control-btn:hover {
            transform: scale(1.1);
        }
        
        .control-btn.play {
            background: linear-gradient(135deg, var(--neon-green), var(--galaxy-gold));
            box-shadow: 0 8px 25px rgba(0, 255, 136, 0.4);
        }
        
        .control-btn.pause {
            background: linear-gradient(135deg, var(--galaxy-gold), var(--plasma-orange));
            box-shadow: 0 8px 25px rgba(255, 215, 0, 0.4);
        }
        
        .control-btn.stop {
            background: linear-gradient(135deg, var(--aurora-pink), var(--nebula-pink));
            box-shadow: 0 8px 25px rgba(255, 61, 113, 0.4);
        }
    </style>
</head>
<body>
    <!-- Enhanced cosmic visual elements -->
    <div class="cosmic-orb"></div>
    <div class="cosmic-orb"></div>
    <div class="cosmic-orb"></div>
    
    <div class="container-fluid app">
        <!-- Navigation Breadcrumb -->
        <nav class="nav-breadcrumb">
            <a href="dashboard.html"><i class="bi bi-house me-1"></i>Dashboard</a>
            <span class="text-muted mx-2">/</span>
            <span class="text-muted">Text-to-Speech</span>
        </nav>

        <header class="d-flex align-items-center justify-content-between mb-4">
            <div class="d-flex align-items-center">
                <div class="logo me-3">
                    <img src="./assets/moon-stoners.png" alt="Moon Stoners logo" class="img-fluid" />
                </div>
                <div class="brand">
                    <h1 class="mb-1">
                        <i class="bi bi-volume-up me-2" style="color: var(--neon-green);"></i>
                        Text-to-Speech
                    </h1>
                    <p class="muted mb-0">Convert text to natural-sounding speech</p>
                </div>
            </div>
            <div class="d-flex align-items-center gap-3">
                <div class="user-info text-end">
                    <small class="text-muted">Welcome,</small>
                    <div id="userGreeting" class="fw-semibold" style="color: var(--cosmic-cyan); font-size: 0.9rem;">
                        Loading...
                    </div>
                </div>
                <button id="logoutBtn" class="btn btn-outline-light btn-sm">
                    <i class="bi bi-box-arrow-right me-1"></i>Logout
                </button>
            </div>
        </header>

        <div class="row g-4">
            <!-- Main Text Editor -->
            <div class="col-lg-8">
                <div class="card editor-panel h-100">
                    <div class="card-body">
                        <div class="editor">
                            <label for="text" class="form-label fw-semibold">
                                <i class="bi bi-textarea-t me-2"></i>Text to read
                            </label>
                            <textarea id="text" class="form-control main-editor" rows="15" placeholder="Type or paste text here, or use the file button to load a .txt file."></textarea>
                            
                            <!-- Reading Controls -->
                            <div class="reading-controls mt-3 mb-3">
                                <div class="d-flex gap-2 justify-content-between align-items-center">
                                    <div class="d-flex gap-2">
                                        <button id="readFromCursor" class="btn btn-info btn-sm" title="Start reading from cursor position">
                                            <i class="bi bi-cursor-text me-1"></i>From Cursor
                                        </button>
                                        <button id="readSelection" class="btn btn-secondary btn-sm" title="Read selected text">
                                            <i class="bi bi-selection me-1"></i>Read Selection
                                        </button>
                                    </div>
                                    <div class="d-flex gap-2">
                                        <label class="btn btn-primary btn-sm" for="file">
                                            <i class="bi bi-upload me-1"></i>Upload File
                                        </label>
                                        <input id="file" type="file" accept=".txt" class="d-none" />
                                        <div class="form-check">
                                            <input id="fileAutoSpeak" type="checkbox" class="form-check-input" />
                                            <label class="form-check-label small" for="fileAutoSpeak">Auto speak</label>
                                        </div>
                                        <button id="loadSample" class="btn btn-outline-light btn-sm">
                                            <i class="bi bi-file-text me-1"></i>Sample
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <div id="tokenized" class="tokenized mt-3" hidden aria-hidden="true"></div>

                            <!-- Playback Controls -->
                            <div class="playback-controls mt-4">
                                <div class="d-flex justify-content-center align-items-center">
                                    <button id="prev" class="btn btn-outline-light btn-sm me-3" title="Previous">
                                        <i class="bi bi-skip-backward-fill"></i>
                                    </button>
                                    <button id="play" class="control-btn play" title="Play / Resume">
                                        <i class="bi bi-play-fill"></i>
                                    </button>
                                    <button id="pause" class="control-btn pause" title="Pause">
                                        <i class="bi bi-pause-fill"></i>
                                    </button>
                                    <button id="stop" class="control-btn stop" title="Stop">
                                        <i class="bi bi-stop-fill"></i>
                                    </button>
                                    <button id="next" class="btn btn-outline-light btn-sm ms-3" title="Next">
                                        <i class="bi bi-skip-forward-fill"></i>
                                    </button>
                                </div>
                                <div class="mt-3">
                                    <span id="statusText" class="badge bg-success">idle</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Voice Settings Panel -->
            <div class="col-lg-4">
                <div class="tools-panel">
                    <!-- Voice Selection -->
                    <div class="card control-group mb-3">
                        <div class="card-header">
                            <h6 class="mb-0"><i class="bi bi-person-voice me-2"></i>Voice Selection</h6>
                        </div>
                        <div class="card-body">
                            <div class="voice-preview-section">
                                <div class="row g-2 align-items-center mb-2">
                                    <div class="col">
                                        <select id="voice" class="form-select form-select-sm"></select>
                                    </div>
                                    <div class="col-auto">
                                        <button id="voicePreview" class="btn btn-outline-primary btn-sm" title="Preview voice">
                                            <i class="bi bi-volume-up"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="row g-2 align-items-center mb-2">
                                    <div class="col-auto">
                                        <label for="gender" class="form-label small mb-0">Gender:</label>
                                    </div>
                                    <div class="col">
                                        <select id="gender" class="form-select form-select-sm">
                                            <option value="any">Any</option>
                                            <option value="female">Female</option>
                                            <option value="male">Male</option>
                                        </select>
                                    </div>
                                    <div class="col-auto">
                                        <button id="suggestVoice" class="btn btn-outline-secondary btn-sm">
                                            <i class="bi bi-magic"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="form-check mb-2">
                                    <input id="requireGender" type="checkbox" class="form-check-input" />
                                    <label class="form-check-label small" for="requireGender">Require preferred gender</label>
                                </div>
                                <div id="voiceWarning" class="text-muted small mb-2"></div>
                                <button id="showVoices" class="btn btn-outline-light btn-sm w-100" title="List all voices">
                                    <i class="bi bi-list me-1"></i>Show All Voices
                                </button>
                                <div id="voiceList" class="text-muted small mt-2" hidden></div>
                            </div>
                        </div>
                    </div>

                    <!-- Playback Settings -->
                    <div class="card control-group mb-3">
                        <div class="card-header">
                            <h6 class="mb-0"><i class="bi bi-sliders me-2"></i>Playback Settings</h6>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label for="rate" class="form-label small d-flex justify-content-between">
                                    <span>Speed</span>
                                    <span id="rateVal" class="badge bg-secondary">1.0</span>
                                </label>
                                <input id="rate" type="range" class="form-range" min="0.5" max="2.0" step="0.1" value="1" />
                            </div>
                            <div class="mb-3">
                                <label for="pitch" class="form-label small d-flex justify-content-between">
                                    <span>Pitch</span>
                                    <span id="pitchVal" class="badge bg-secondary">1.0</span>
                                </label>
                                <input id="pitch" type="range" class="form-range" min="0" max="2" step="0.1" value="1" />
                            </div>
                            <div class="mb-3">
                                <label for="volume" class="form-label small d-flex justify-content-between">
                                    <span>Volume</span>
                                    <span id="volumeVal" class="badge bg-secondary">1.0</span>
                                </label>
                                <input id="volume" type="range" class="form-range" min="0" max="1" step="0.05" value="1" />
                            </div>
                            <div class="mb-3">
                                <label for="segmentDelay" class="form-label small d-flex justify-content-between">
                                    <span>Sentence pause</span>
                                    <span><span id="segmentDelayVal" class="badge bg-secondary">200</span> ms</span>
                                </label>
                                <input id="segmentDelay" type="range" class="form-range" min="0" max="800" step="25" value="200" />
                            </div>
                            <div class="form-check">
                                <input id="highlight" type="checkbox" class="form-check-input" checked />
                                <label class="form-check-label small" for="highlight">Highlight words while reading</label>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="card control-group mb-3">
                        <div class="card-header">
                            <h6 class="mb-0"><i class="bi bi-lightning me-2"></i>Quick Actions</h6>
                        </div>
                        <div class="card-body">
                            <div class="d-grid gap-2">
                                <button class="btn btn-outline-primary btn-sm" onclick="navigateTo('ocr.html')">
                                    <i class="bi bi-camera me-2"></i>OCR Tools
                                </button>
                                <button class="btn btn-outline-success btn-sm" onclick="navigateTo('translation.html')">
                                    <i class="bi bi-translate me-2"></i>Translation
                                </button>
                                <button class="btn btn-outline-info btn-sm" onclick="navigateTo('voice-input.html')">
                                    <i class="bi bi-mic me-2"></i>Voice Input
                                </button>
                                <button class="btn btn-outline-secondary btn-sm" onclick="navigateTo('settings.html')">
                                    <i class="bi bi-gear me-2"></i>Settings
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Keyboard Shortcuts -->
                    <div class="card control-group">
                        <div class="card-body">
                            <div class="text-muted small">
                                <strong>Keyboard Shortcuts:</strong><br>
                                <kbd>Space</kbd> Play/Pause<br>
                                <kbd>S</kbd> Stop<br>
                                <kbd>L</kbd> Load sample
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Enhanced colorful accent elements -->
        <div class="cosmic-accents">
            <div class="accent-line accent-line-1"></div>
            <div class="accent-line accent-line-2"></div>
            <div class="accent-dot accent-dot-1"></div>
            <div class="accent-dot accent-dot-2"></div>
            <div class="cosmic-shape shape-triangle"></div>
            <div class="cosmic-shape shape-diamond"></div>
            <div class="sparkle sparkle-1"></div>
            <div class="sparkle sparkle-2"></div>
        </div>

        <footer class="cosmic-footer">
            <div class="footer-content">
                <div class="footer-glow"></div>
                <small>
                    <i class="bi bi-stars me-2"></i>
                    Text-to-Speech Tool — Moon Stoners TTS Reader
                    <i class="bi bi-stars ms-2"></i>
                </small>
            </div>
        </footer>
    </div>

    <!-- Bootstrap JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Authentication Database -->
    <script src="auth-db.js"></script>
    
    <script>
        // Navigation function
        function navigateTo(page) {
            window.location.href = page;
        }

        // Include the TTS functionality from kc.js (simplified version)
        // This would include all the TTS-related functions from the original kc.js
        // For brevity, I'm including the essential parts here
        
        // Authentication check
        const isLoggedIn = localStorage.getItem('kc_logged_in');
        const currentUser = localStorage.getItem('kc_user');
        
        if(!(isLoggedIn === '1')){
            window.location.href = 'login.html';
        }

        // Initialize user greeting
        function initUserGreeting() {
            const userGreeting = document.getElementById('userGreeting');
            if (!userGreeting) return;

            const userData = localStorage.getItem('kc_user_data');
            
            if (userData) {
                try {
                    const user = JSON.parse(userData);
                    const displayName = user.fullName || user.username || currentUser;
                    userGreeting.textContent = displayName;
                    
                    if (user.username === 'admin') {
                        userGreeting.innerHTML = `${displayName} <span class="badge bg-danger ms-1" style="font-size: 0.7rem;">Admin</span>`;
                    }
                } catch (error) {
                    userGreeting.textContent = currentUser || 'User';
                }
            } else {
                userGreeting.textContent = currentUser || 'Guest';
            }
        }

        // Logout functionality
        document.getElementById('logoutBtn').addEventListener('click', async (e) => {
            e.preventDefault();
            
            const confirmLogout = confirm('Are you sure you want to logout?');
            if (!confirmLogout) return;
            
            localStorage.removeItem('kc_logged_in');
            localStorage.removeItem('kc_user');
            localStorage.removeItem('kc_user_data');
            
            window.location.href = 'login.html';
        });

        // Load sample text
        function loadSample() {
            const sample = `Hello — welcome to the Text-to-Speech tool.\n\nThis is a dedicated interface for converting text to natural-sounding speech. You can adjust voice settings, playback speed, and use advanced features like word highlighting.\n\nUse the controls on the right to customize your experience, then press Play to hear your text.`;
            document.getElementById('text').value = sample;
            setStatus('Sample loaded', 'status-ok');
        }

        // Status function
        function setStatus(message, className) {
            const statusText = document.getElementById('statusText');
            statusText.textContent = message;
            statusText.className = `badge ${className}`;
        }

        // Initialize
        setTimeout(() => {
            initUserGreeting();
        }, 100);

        // Add event listeners for sample button
        document.getElementById('loadSample').addEventListener('click', loadSample);

        // Placeholder for TTS functionality - in a real implementation, 
        // you would include the full TTS code from kc.js here
        console.log('TTS page loaded successfully');
    </script>
</body>
</html>