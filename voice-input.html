<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Voice Input - Moon Stoners TTS Reader</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <!-- Custom Cosmic Theme -->
    <link rel="stylesheet" href="kc.css" />
    <style>
        .nav-breadcrumb {
            background: rgba(10, 10, 15, 0.1);
            border-radius: 10px;
            padding: 0.5rem 1rem;
            margin-bottom: 1rem;
            border: 1px solid rgba(0, 212, 255, 0.1);
        }
        
        .nav-breadcrumb a {
            color: var(--cosmic-cyan);
            text-decoration: none;
        }
        
        .nav-breadcrumb a:hover {
            color: var(--aurora-pink);
        }
        
        .voice-control-center {
            background: linear-gradient(135deg, 
                rgba(255, 61, 113, 0.1), 
                rgba(157, 78, 221, 0.1));
            border-radius: 30px;
            padding: 3rem;
            text-align: center;
            border: 1px solid rgba(255, 61, 113, 0.2);
        }
        
        .voice-button {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            border: none;
            font-size: 3rem;
            color: white;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .voice-button.inactive {
            background: linear-gradient(135deg, var(--cosmic-cyan), var(--aurora-pink));
            box-shadow: 0 10px 30px rgba(0, 212, 255, 0.4);
        }
        
        .voice-button.active {
            background: linear-gradient(135deg, var(--neon-green), var(--galaxy-gold));
            box-shadow: 0 15px 40px rgba(0, 255, 136, 0.6);
            animation: pulse 2s ease-in-out infinite;
        }
        
        .voice-button:hover {
            transform: scale(1.1);
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .voice-status {
            margin-top: 2rem;
            font-size: 1.2rem;
            font-weight: 600;
        }
        
        .voice-status.listening {
            color: var(--neon-green);
            text-shadow: 0 0 10px rgba(0, 255, 136, 0.5);
        }
        
        .voice-status.idle {
            color: var(--text-secondary);
        }
        
        .voice-status.processing {
            color: var(--cosmic-cyan);
            text-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
        }
    </style>
</head>
<body data-page="voice-input">
    <!-- Enhanced cosmic visual elements -->
    <div class="cosmic-orb"></div>
    <div class="cosmic-orb"></div>
    <div class="cosmic-orb"></div>
    
    <!-- Navigation -->
    <nav class="main-navigation" role="navigation" aria-label="Main navigation"></nav>
    
    <!-- Page Content -->
    <main class="page-content" role="main">
        <div class="container-fluid">
            <!-- Navigation Breadcrumb -->
            <nav class="nav-breadcrumb">
                <a href="dashboard.html"><i class="bi bi-house me-1"></i>Dashboard</a>
                <span class="text-muted mx-2">/</span>
                <span class="text-muted">Voice Input</span>
            </nav>

        <header class="page-header">
            <h1 class="page-title">
                <i class="bi bi-mic"></i>
                Voice Input
            </h1>
            <p class="page-subtitle">Convert speech to text with AI-powered recognition</p>
        </header>

        <div class="row g-4">
            <!-- Voice Control Center -->
            <div class="col-lg-6">
                <div class="card h-100">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="bi bi-mic-fill me-2"></i>
                            Voice Recognition
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="voice-control-center">
                            <button id="voiceInputBtn" class="voice-button inactive">
                                <i class="bi bi-mic-fill"></i>
                            </button>
                            <div id="voiceStatus" class="voice-status idle">
                                Click to start voice input
                            </div>
                            <p class="text-muted mt-3 mb-0">
                                Speak clearly into your microphone<br>
                                <small>Supports multiple languages and auto-formatting</small>
                            </p>
                        </div>

                        <!-- Voice Settings -->
                        <div class="row g-3 mt-4">
                            <div class="col-md-6">
                                <label for="speechLang" class="form-label small">Recognition Language:</label>
                                <select id="speechLang" class="form-select form-select-sm">
                                    <option value="en">English</option>
                                    <option value="es">Spanish</option>
                                    <option value="fr">French</option>
                                    <option value="de">German</option>
                                    <option value="it">Italian</option>
                                    <option value="pt">Portuguese</option>
                                    <option value="ru">Russian</option>
                                    <option value="zh">Chinese</option>
                                    <option value="ja">Japanese</option>
                                    <option value="ko">Korean</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label small">Options:</label>
                                <div class="form-check">
                                    <input id="voiceAutoFormat" type="checkbox" class="form-check-input" checked />
                                    <label class="form-check-label small" for="voiceAutoFormat">Auto-format text</label>
                                </div>
                                <div class="form-check">
                                    <input id="voiceSpeak" type="checkbox" class="form-check-input" />
                                    <label class="form-check-label small" for="voiceSpeak">Auto-speak result</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Text Output -->
            <div class="col-lg-6">
                <div class="card h-100">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="bi bi-file-text me-2"></i>
                            Transcribed Text
                        </h5>
                    </div>
                    <div class="card-body">
                        <textarea id="transcribedText" class="form-control" rows="15" 
                            placeholder="Your speech will appear here..."></textarea>
                        
                        <!-- Text Actions -->
                        <div class="d-flex gap-2 mt-3 flex-wrap">
                            <button id="clearTranscript" class="btn btn-outline-secondary btn-sm">
                                <i class="bi bi-x-circle me-1"></i>Clear
                            </button>
                            <button id="copyTranscript" class="btn btn-outline-primary btn-sm">
                                <i class="bi bi-clipboard me-1"></i>Copy
                            </button>
                            <button id="speakTranscript" class="btn btn-outline-success btn-sm">
                                <i class="bi bi-volume-up me-1"></i>Speak
                            </button>
                            <button id="translateTranscript" class="btn btn-outline-info btn-sm">
                                <i class="bi bi-translate me-1"></i>Translate
                            </button>
                            <button id="saveTranscript" class="btn btn-outline-warning btn-sm">
                                <i class="bi bi-download me-1"></i>Save
                            </button>
                        </div>

                        <!-- Mode Selection -->
                        <div class="mt-4">
                            <h6 class="mb-3">Text Mode:</h6>
                            <div class="form-check">
                                <input id="voiceReplace" type="radio" name="textMode" class="form-check-input" />
                                <label class="form-check-label small" for="voiceReplace">
                                    Replace existing text
                                </label>
                            </div>
                            <div class="form-check">
                                <input id="voiceAppend" type="radio" name="textMode" class="form-check-input" checked />
                                <label class="form-check-label small" for="voiceAppend">
                                    Append to existing text
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Navigation -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-body">
                        <h6 class="mb-3">
                            <i class="bi bi-lightning me-2"></i>
                            Quick Actions
                        </h6>
                        <div class="d-flex gap-2 flex-wrap">
                            <button class="btn btn-outline-primary btn-sm" onclick="navigateTo('tts.html')">
                                <i class="bi bi-volume-up me-1"></i>Text-to-Speech
                            </button>
                            <button class="btn btn-outline-info btn-sm" onclick="navigateTo('ocr.html')">
                                <i class="bi bi-camera me-1"></i>OCR Tools
                            </button>
                            <button class="btn btn-outline-success btn-sm" onclick="navigateTo('translation.html')">
                                <i class="bi bi-translate me-1"></i>Translation
                            </button>
                            <button class="btn btn-outline-secondary btn-sm" onclick="navigateTo('settings.html')">
                                <i class="bi bi-gear me-1"></i>Settings
                            </button>
                            <button class="btn btn-outline-warning btn-sm" onclick="navigateTo('kc.html')">
                                <i class="bi bi-grid-3x3-gap me-1"></i>All-in-One
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Enhanced colorful accent elements -->
        <div class="cosmic-accents">
            <div class="accent-line accent-line-1"></div>
            <div class="accent-line accent-line-2"></div>
            <div class="accent-dot accent-dot-1"></div>
            <div class="accent-dot accent-dot-2"></div>
            <div class="cosmic-shape shape-triangle"></div>
            <div class="cosmic-shape shape-diamond"></div>
            <div class="sparkle sparkle-1"></div>
            <div class="sparkle sparkle-2"></div>
        </div>

        <footer class="cosmic-footer">
            <div class="footer-content">
                <div class="footer-glow"></div>
                <small>
                    <i class="bi bi-stars me-2"></i>
                    Voice Input Tools â€” Moon Stoners TTS Reader
                    <i class="bi bi-stars ms-2"></i>
                </small>
            </div>
        </footer>
        </div>
    </main>

    <!-- Bootstrap JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Authentication Database -->
    <script src="auth-db.js"></script>
    <!-- Shared Navigation -->
    <script src="shared-navigation.js"></script>
    
    <script>
        // Navigation function
        function navigateTo(page) {
            window.location.href = page;
        }

        // Authentication check
        const isLoggedIn = localStorage.getItem('kc_logged_in');
        const currentUser = localStorage.getItem('kc_user');
        
        if(!(isLoggedIn === '1')){
            window.location.href = 'login.html';
        }



        // Voice recognition functionality
        let recognition = null;
        let isRecognizing = false;

        function setVoiceStatus(status, className = 'idle') {
            const statusEl = document.getElementById('voiceStatus');
            statusEl.textContent = status;
            statusEl.className = `voice-status ${className}`;
        }

        function createRecognition() {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            if (!SpeechRecognition) return null;

            const recognition = new SpeechRecognition();
            recognition.lang = document.getElementById('speechLang').value || 'en';
            recognition.interimResults = true;
            recognition.continuous = false;
            recognition.maxAlternatives = 1;

            recognition.onstart = () => {
                isRecognizing = true;
                setVoiceStatus('Listening... Speak now', 'listening');
                document.getElementById('voiceInputBtn').className = 'voice-button active';
                document.getElementById('voiceInputBtn').innerHTML = '<i class="bi bi-stop-fill"></i>';
            };

            recognition.onend = () => {
                isRecognizing = false;
                setVoiceStatus('Click to start voice input', 'idle');
                document.getElementById('voiceInputBtn').className = 'voice-button inactive';
                document.getElementById('voiceInputBtn').innerHTML = '<i class="bi bi-mic-fill"></i>';
            };

            recognition.onerror = (event) => {
                console.error('Speech recognition error:', event.error);
                setVoiceStatus('Error: ' + event.error, 'idle');
            };

            recognition.onresult = (event) => {
                let interimTranscript = '';
                let finalTranscript = '';

                for (let i = event.resultIndex; i < event.results.length; i++) {
                    const transcript = event.results[i][0].transcript;
                    if (event.results[i].isFinal) {
                        finalTranscript += transcript;
                    } else {
                        interimTranscript += transcript;
                    }
                }

                if (interimTranscript) {
                    setVoiceStatus('Processing: ' + interimTranscript.substring(0, 50) + '...', 'processing');
                }

                if (finalTranscript) {
                    let processedText = finalTranscript;
                    
                    // Auto-format if enabled
                    if (document.getElementById('voiceAutoFormat').checked) {
                        processedText = autoFormatText(processedText);
                    }

                    // Apply text based on mode
                    const transcriptArea = document.getElementById('transcribedText');
                    if (document.getElementById('voiceReplace').checked) {
                        transcriptArea.value = processedText;
                    } else {
                        transcriptArea.value += (transcriptArea.value ? '\n\n' : '') + processedText;
                    }

                    // Auto-speak if enabled
                    if (document.getElementById('voiceSpeak').checked) {
                        speakText(processedText);
                    }

                    setVoiceStatus('Transcription complete', 'idle');
                }
            };

            return recognition;
        }

        function autoFormatText(text) {
            if (!text) return text;
            
            // Normalize whitespace
            text = text.replace(/\s+/g, ' ').trim();
            
            // Capitalize first letter
            text = text.charAt(0).toUpperCase() + text.slice(1);
            
            // Add period if no ending punctuation
            if (!/[.!?]$/.test(text)) {
                text += '.';
            }
            
            return text;
        }

        function speakText(text) {
            if ('speechSynthesis' in window && text) {
                const utterance = new SpeechSynthesisUtterance(text);
                speechSynthesis.speak(utterance);
            }
        }

        // Event listeners
        document.getElementById('voiceInputBtn').addEventListener('click', () => {
            if (!window.SpeechRecognition && !window.webkitSpeechRecognition) {
                alert('Speech recognition is not supported in this browser');
                return;
            }

            if (!recognition) {
                recognition = createRecognition();
            }

            if (!recognition) {
                alert('Speech recognition is not available');
                return;
            }

            if (isRecognizing) {
                recognition.stop();
            } else {
                // Update language
                recognition.lang = document.getElementById('speechLang').value || 'en';
                recognition.start();
            }
        });

        // Action buttons
        document.getElementById('clearTranscript').addEventListener('click', () => {
            document.getElementById('transcribedText').value = '';
        });

        document.getElementById('copyTranscript').addEventListener('click', () => {
            const text = document.getElementById('transcribedText').value;
            if (text) {
                navigator.clipboard.writeText(text).then(() => {
                    alert('Text copied to clipboard!');
                });
            }
        });

        document.getElementById('speakTranscript').addEventListener('click', () => {
            const text = document.getElementById('transcribedText').value;
            if (text) speakText(text);
        });

        document.getElementById('translateTranscript').addEventListener('click', () => {
            const text = document.getElementById('transcribedText').value;
            if (text) {
                localStorage.setItem('kc_text_to_translate', text);
                navigateTo('translation.html');
            }
        });

        document.getElementById('saveTranscript').addEventListener('click', () => {
            const text = document.getElementById('transcribedText').value;
            if (text) {
                const blob = new Blob([text], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'voice_transcript.txt';
                a.click();
                URL.revokeObjectURL(url);
            }
        });

        // Initialize

        console.log('Voice Input page loaded successfully');
    </script>
</body>
</html>